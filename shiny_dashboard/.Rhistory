library(shiny)
library(tidyverse)
library(lubridate)
library(rvest) #To parse table from webpage
library(nasapower) #API for NASA data, for precipitation
library(openmeteo)
#USGS site keys. Currently includes Mendota and Monona
site_keys = c("05428000", "05429000")
n_lakes = length(site_keys)
#The base urls used by the USGS for lake data
url_base = c("https://waterservices.usgs.gov/nwis/iv/?format=rdb&sites=")
#Parameters from the NASA POWER data collection
nasa_pars = c("PRECTOTCORR")
#Preallocate the important historical data tables 
lake_table = vector("list", n_lakes)
daily_precip = vector("list", n_lakes)
real_start = vector("list", n_lakes)
#Final data set
lake_data = vector("list", n_lakes)
 current_date = Sys.Date() #Current date. Could be set to other
  lake_table[[1]] = read.csv(file = "./../data/men_hist.csv")
  lake_table[[2]] = read.csv(file = "./../data/mon_hist.csv")
  daily_precip[[1]] = read.csv(file = "./../data/rain_hist.csv")
  daily_precip[[2]] = daily_precip[[1]]
head(lake_table[[1]])
  lake_table[[1]][,"time"] = as.POSIXct(lake_table[[1]][,"time"],
                       format = '%Y-%m-%d')
head(lake_table[[1]])
  lake_table[[2]] = read.csv(file = "./../data/mon_hist.csv")
  lake_table[[2]][,"time"] = as.POSIXct(lake_table[[2]][,"time"],
                       format = '%Y-%m-%d')
  daily_precip[[1]] = read.csv(file = "./../data/rain_hist.csv")
  daily_precip[[1]][,"time"] = as.POSIXct(daily_precip[[1]][,"time"],
                       format = '%Y-%m-%d')
str(daily_precip[[1]])
  daily_precip[[2]] = daily_precip[[1]]
  last_date = vector("list",n_lakes+1)
  last_date = vector("list",n_lakes+1)
  last_date = vector("list",n_lakes)
  last_rain = vector("list",n_lakes)
n=1
    last_date[[n]] = lake_table[[n]][nrow(lake_table[[n]]),"time"]
last_date[[n]] 
for ( n in 1:n_lakes){ 
    last_date[[n]] = lake_table[[n]][nrow(lake_table[[n]]),"time"]
    last_rain[[n]] = daily_precip[[n]][nrow(daily_precip[[n]]),"time"]
  }
laste_date
last_date
last_rain
last_rain[[1]] == last_date[[1]]
  current_date = Sys.Date() #Current date. Could be set to other
current_date
  current_date = as.POSIXct( Sys.Date(), format = '%Y-%m-%d') #Current date. Could be set to other
current_date
?as.POSIXct
as.POSIXct( Sys.Date(), format = '%Y-%m-%d')
as.POSIXct( Sys.Date(), format = '%Y-%m-%d')
Sys.Date
Sys.Date()
ymd(Sys.Date())
  current_date = ymd( Sys.Date() ) #Current date. Could be set to other
  last_date = vector("list",n_lakes)
  last_rain = vector("list",n_lakes)
  current_date = ymd( Sys.Date() ) #Current date. Could be set to other
  lake_table[[1]] = read.csv(file = "./../data/men_hist.csv")
  lake_table[[1]][,"time"] = ymd(lake_table[[1]][,"time"])
  lake_table[[2]] = read.csv(file = "./../data/mon_hist.csv")
  lake_table[[2]][,"time"] = ymd(lake_table[[2]][,"time"])
  daily_precip[[1]] = read.csv(file = "./../data/rain_hist.csv")
  daily_precip[[1]][,"time"] = ymd(daily_precip[[1]][,"time"])
  daily_precip[[2]] = daily_precip[[1]]
laste_date[[n]] != current_date
    if(last_date[[n]] != current_date  )
last_date[[n]] != current_date
current_date
last_date[[n]]
 last_date[[n]] = lake_table[[n]][nrow(lake_table[[n]]),"time"]
n
last_date[[n]] != current_date
last_date[[n]] == current_date
str(lake_table[[1]])
q()
